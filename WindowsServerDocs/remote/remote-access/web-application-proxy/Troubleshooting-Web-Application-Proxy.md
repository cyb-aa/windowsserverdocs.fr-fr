---
title: Résolution des problèmes au niveau du proxy d’application web
ms.author: kgremban
author: eross-msft
ms.date: 07/13/2016
ms.topic: article
ms.prod: windows-server
ms.assetid: a2fef55d-747b-4e20-8f21-5f8807e7ef87
ms.technology: web-app-proxy
ms.openlocfilehash: e0907f2b096301418b5a65b87a06f97af683d4e4
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80818642"
---
# <a name="troubleshooting-web-application-proxy"></a>Résolution des problèmes au niveau du proxy d’application web

>S’applique à Windows Server 2016

**Ce contenu est pertinent pour la version locale du proxy d’application Web. Pour activer l’accès sécurisé aux applications locales sur le Cloud, consultez le [Azure ad le contenu du proxy d’application](https://azure.microsoft.com/documentation/articles/active-directory-application-proxy-get-started/).**  
  
Cette section fournit des procédures de dépannage pour le proxy d’application Web, notamment des explications et des solutions d’événements. Il existe trois emplacements où les erreurs s’affichent :  
  
-   Dans la console administrateur de proxy d’application Web  
  
    Chaque ID d’événement répertorié dans la console administrateur peut être affiché dans le observateur d’événements Windows, et les descriptions et solutions correspondantes sont disponibles ci-dessous.  
  
    Ouvrez observateur d’événements et recherchez les événements liés au proxy d’application Web sous **journaux des applications et des Services** > **Microsoft** > **Windows** > **proxy d’application Web** > **administrateur**  
  
    ![](media/Troubleshooting-Web-Application-Proxy/WebApplicationProxyTroubleshooting.png)  
  
    Si nécessaire, des journaux détaillés sont disponibles en activant les journaux d’analyse et de débogage et en activant le journal de session du proxy d’application Web, situé dans le observateur d’événements Windows sous \ Microsoft \ Windows \ proxy d’application Web \ admin.  
  
-   Dans les erreurs PowerShell  
  
    Les événements relatifs aux problèmes rencontrés lors de la configuration s’affichent dans PowerShell.  
  
    Toutes les erreurs sont présentées à l’utilisateur PowerShell à l’aide d’invites d’erreur PowerShell standard. Toutes les commandes PowerShell sont consignées en tant qu’événements. Tous les événements qui se produisent dans PowerShell sont répertoriés dans le observateur d’événements Windows portant le numéro d’ID 12016 et sont définis ci-dessous dans la section PowerShell.  
  
-   Dans le Best Practices Analyzer  
  
    Ces événements sont décrits dans le [Best Practices Analyzer pour le proxy d’application Web](assetId:///995f5cea-e334-4ce6-a14c-6a2d03c0c79a) .  
  
## <a name="powershell-messages"></a>Messages PowerShell  
  
|Événement ou symptôme|Cause possible|Résolution|  
|--------------------|------------------|--------------|  
|Le certificat de confiance (« ADFS ProxyTrust-<WAP machine name>») n’est pas valide|Cela peut se produire pour l'une des raisons suivantes :<p>-L’ordinateur proxy d’application était trop longtemps.<br />-Déconnexions entre le proxy d’application Web et AD FS<br />-Problèmes liés à l’infrastructure de certificat<br />-Les modifications apportées sur l’ordinateur AD FS, ou le processus de renouvellement entre le proxy d’application Web et le AD FS ne se sont pas exécutés comme prévu toutes les 8 heures, puis ils doivent renouveler l’approbation.<br />-L’horloge de l’ordinateur du proxy d’application Web et du AD FS ne sont pas synchronisées.|Assurez-vous que les horloges sont synchronisées. Exécutez l’applet de commande Install-WebApplicationProxy.|  
|Les données de configuration sont introuvables dans AD FS|Cela peut être dû au fait que le proxy d’application Web n’a pas encore été complètement installé ou en raison des modifications apportées à la base de données AD FS ou à une altération de la base de données.|Exécutez l’applet de commande Install-WebApplicationProxy|  
|Une erreur s’est produite lors de la tentative de lecture de la configuration à partir d’AD FS par le proxy d’application Web.|Cela peut indiquer que AD FS n’est pas accessible ou que AD FS rencontré un problème interne lors de la tentative de lecture de la configuration à partir de la base de données AD FS.|Vérifiez que AD FS est accessible et fonctionne correctement.|  
|Les données de configuration stockées dans AD FS sont endommagées ou le proxy d’application Web n’a pas pu les analyser.<p>\- OU -<p>Proxywas d’application Web ne peut pas récupérer la liste des parties de confiance AD FS.|Cela peut se produire si les données de configuration ont été modifiées dans AD FS.|Redémarrez l’application Web Proxyservice. Si le problème persiste, exécutez l’applet de commande Install-WebApplicationProxy.|  
  
## <a name="administrator-console-events"></a>Événements de Console Administrateur  
Les événements de la console administrateur suivants indiquent généralement des erreurs d’authentification, des cookies Tokes ou expirés non valides.  
  
|Événement ou symptôme|Cause possible|Résolution|  
|--------------------|------------------|--------------|  
|11005<p>Le proxy d’application Web n’a pas pu créer la clé de chiffrement de cookie à l’aide du secret de la configuration.|Le paramètre « AccessCookiesEncryptionKey » de la configuration globale a été modifié par la commande PowerShell : Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey|Aucune action n’est nécessaire. Le cookie problématique a été supprimé et l’utilisateur a été redirigé vers STS pour l’authentification.|  
|12000<p>Le proxy d’application Web n’a pas pu vérifier les modifications de configuration pendant au moins 60 minutes|Le proxy d’application Web ne peut pas accéder à la configuration du proxy d’application Web à l’aide de la commande-WebApplicationProxyConfiguration/application. Cela est généralement dû à un manque de connectivité avec AD FS ou au besoin de renouveler la confiance avec AD FS.|Vérifiez la connectivité avec AD FS. Pour ce faire, vous pouvez utiliser le lien https://< FQDN_AD_FS_Proxy >/FederationMetadata/2007-06/FederationMetadata.xmlMake Vérifiez qu’une approbation est établie entre le AD FS et le proxy d’application Web. Si ces solutions ne fonctionnent pas, exécutez l’applet de commande Install-WebApplicationProxy.|  
|12003<p>Le proxy d’application Web n’a pas pu analyser le cookie d’accès.|Cela peut indiquer que le proxy d’application Web et le AD FS ne sont pas connectés ou qu’ils ne reçoivent pas la même configuration.|Vérifiez la connectivité avec AD FS. Pour ce faire, vous pouvez utiliser le lien https://< FQDN_AD_FS_Proxy >/FederationMetadata/2007-06/FederationMetadata.xmlMake Vérifiez qu’une approbation est établie entre le AD FS et le proxy d’application Web. Si ces solutions ne fonctionnent pas, exécutez l’applet de commande Install-WebApplicationProxy.|  
|12004<p>Le proxy d’application Web a reçu une demande avec un cookie d’accès non valide.|Cet événement peut indiquer que le proxy d’application Web et le AD FS ne sont pas connectés ou qu’ils ne reçoivent pas la même configuration.<p>Si vous avez exécuté le paramètre « AccessCookiesEncryptionKey » chaged par la commande PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, cet événement est normal et ne nécessite aucune étape de résolution.|Vérifiez la connectivité avec AD FS. Pour ce faire, vous pouvez utiliser le lien https://< FQDN_AD_FS_Proxy >/FederationMetadata/2007-06/FederationMetadata.xmlMake Vérifiez qu’une approbation est établie entre le AD FS et le proxy d’application Web. Si ces solutions ne fonctionnent pas, exécutez l’applet de commande Install-WebApplicationProxy.|  
|12008<p>Le proxy d’application Web a dépassé le nombre maximal de tentatives d’authentification Kerberos autorisées sur le serveur principal.|Cet événement peut indiquer une configuration incorrecte entre le proxy d’application Web et le serveur d’applications principal, ou un problème de configuration de l’heure et de la date sur les deux ordinateurs.|Le serveur principal a refusé le ticket Kerberos créé par le proxy d’application Web. Vérifiez que la configuration du proxy d’application Web et du serveur d’applications principal est configurée correctement.<p>Assurez-vous que la configuration de la date et de l’heure sur le proxy d’application Web et le serveur d’applications principal sont synchronisées.|  
|12011<p>Le proxy d’application Web a reçu une demande avec une signature de cookie d’accès non valide.|Cet événement peut indiquer que le proxy d’application Web et le AD FS ne sont pas connectés ou qu’ils ne reçoivent pas la même configuration. Si vous avez exécuté le paramètre « AccessCookiesEncryptionKey » chaged par la commande PowerShell Set-WebApplicationProxyConfiguration-RegenerateAccessCookiesEncryptionKey, cet événement est normal et ne nécessite aucune étape de résolution.|Vérifiez la connectivité avec AD FS. Pour ce faire, vous pouvez utiliser le lien https://< FQDN_AD_FS_Proxy >/FederationMetadata/2007-06/FederationMetadata.xmlMake Vérifiez qu’une approbation est établie entre le AD FS et le proxy d’application Web. Si ces solutions ne fonctionnent pas, exécutez l’applet de commande Install-WebApplicationProxy.|  
|12027<p>Le proxy a rencontré une erreur inattendue lors du traitement de la demande. Le nom fourni n’est pas un nom de compte correctement formé.|Cet événement peut indiquer une configuration incorrecte entre le proxy d’application Web et le serveur de contrôleur de domaine, ou un problème de configuration de l’heure et de la date sur les deux ordinateurs.|Le contrôleur de domaine a refusé le ticket Kerberos créé par le proxy d’application Web. Vérifiez que la configuration du proxy d’application Web et du serveur d’applications principal est configurée correctement, en particulier la configuration du SPN. Assurez-vous que le proxy d’application Web est joint à un domaine au même domaine que le contrôleur de domaine pour vous assurer que le contrôleur de domaine établit une relation de confiance avec le proxy d’application Web. Assurez-vous que la configuration de la date et de l’heure sur le proxy d’application Web et le contrôleur de domaine est synchronisée.|  
|13012<p>Le proxy d’application Web a reçu une signature de jeton de périphérie non valide||Assurez-vous que vous avez mis à jour le proxy d’application Web avec [KB 2955164](https://go.microsoft.com/fwlink/?LinkId=400701).|  
|13013<p>Le proxy d’application Web a reçu une demande qui contenait un jeton de périphérie expiré.|Le proxy d’application Web et les AD FS n’ont pas d’horloges synchronisées.|Synchroniser les horloges entre le proxy d’application Web et AD FS.|  
|13014<p>Le proxy d’application Web a reçu une demande avec un jeton de périphérie non valide. Le jeton n’est pas valide, car il n’a pas pu être analysé.|Cela peut indiquer un problème avec la configuration de l’AD FS.|Vérifiez la configuration de votre AD FS et, si nécessaire, restaurez la configuration par défaut.|  
|13015<p>Le proxy d’application Web a reçu une demande avec un cookie d’accès expiré.|Cela peut indiquer des horloges qui ne sont pas synchronisées.|Si vous utilisez un cluster de machines proxy d’application Web, assurez-vous que la date et l’heure des machines sont synchronisées.|  
|13016<p>Le proxy d’application Web ne peut pas récupérer un ticket Kerberos pour le compte de l’utilisateur, car il n’existe aucun UPN dans le jeton de périphérie ou dans le cookie d’accès.|Il y a un problème avec la configuration de STS.|Corrigez la configuration des revendications UPN dans le STS.|  
|13019<p>Le proxy d’application Web ne peut pas récupérer un ticket Kerberos pour le compte de l’utilisateur en raison de l’erreur d’API générale suivante|Cet événement peut indiquer une configuration incorrecte entre le proxy d’application Web et le serveur de contrôleur de domaine, ou un problème de configuration de l’heure et de la date sur les deux ordinateurs.|Le contrôleur de domaine a refusé le ticket Kerberos créé par le proxy d’application Web. Vérifiez que la configuration du proxy d’application Web et du serveur d’applications principal est configurée correctement, en particulier la configuration du SPN. Assurez-vous que le proxy d’application Web est joint à un domaine au même domaine que le contrôleur de domaine pour vous assurer que le contrôleur de domaine établit une relation de confiance avec le proxy d’application Web. Assurez-vous que la configuration de la date et de l’heure sur le proxy d’application Web et le contrôleur de domaine est synchronisée.|  
|13020<p>Le proxy d’application Web ne peut pas récupérer un ticket Kerberos pour le compte de l’utilisateur, car le SPN du serveur principal n’est pas défini.|Cet événement peut indiquer une configuration incorrecte entre le proxy d’application Web et le serveur de contrôleur de domaine, ou un problème de configuration de l’heure et de la date sur les deux ordinateurs.|Le contrôleur de domaine a refusé le ticket Kerberos créé par le proxy d’application Web. Vérifiez que la configuration du proxy d’application Web et du serveur d’applications principal est configurée correctement, en particulier la configuration du SPN. Assurez-vous que le proxy d’application Web est joint à un domaine au même domaine que le contrôleur de domaine pour vous assurer que le contrôleur de domaine établit une relation de confiance avec le proxy d’application Web. Assurez-vous que la configuration de la date et de l’heure sur le proxy d’application Web et le contrôleur de domaine est synchronisée.|  
|13022<p>Le proxy d’application Web ne peut pas authentifier l’utilisateur, car le serveur principal répond aux tentatives d’authentification Kerberos avec une erreur HTTP 401.|Cet événement peut indiquer une configuration incorrecte entre le proxy d’application Web et le serveur d’applications principal, ou un problème de configuration de l’heure et de la date sur les deux ordinateurs.|Le serveur principal a refusé le ticket Kerberos créé par le proxy d’application Web. Vérifiez que la configuration du proxy d’application Web et du serveur d’applications principal est configurée correctement. Assurez-vous que la configuration de la date et de l’heure sur le proxy d’application Web et le serveur d’applications principal sont synchronisées.|  
|13025<p>Le client n’a pas présent de certificat SSL pour le proxy d’application Web.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13026<p>Le client a présenté un certificat SSL vers le proxy d’application Web, mais le certificat n’est pas valide : le certificat ne correspond pas à l’empreinte numérique.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13028<p>Le proxy d’application Web a reçu une demande qui contenait un jeton de périphérie qui n’est pas encore valide.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées.|  
|13030<p>Le client a présenté un certificat SSL vers le proxy d’application Web, mais le fournisseur d’approbation n’approuve pas l’autorité de certification qui a émis le certificat client.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13031<p>Le client a présenté un certificat SSL au proxy d’application Web, mais la chaîne de certificats s’est arrêtée dans un certificat racine qui n’est pas approuvé par le fournisseur d’approbation.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13032<p>Le client a présenté un certificat SSL au proxy d’application Web, mais le certificat n’était pas valide pour l’utilisation demandée.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13033<p>Le client a présenté un certificat SSL au proxy d’application Web, mais le certificat n’était pas dans sa période de validité lors de la vérification par rapport à l’horloge système actuelle ou de l’horodateur dans le fichier signé.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
|13034<p>Le client a présenté un certificat SSL au proxy d’application Web, mais le certificat n’était pas valide.|Cet événement peut indiquer un problème de configuration de la date et de l’heure.|Assurez-vous que l’infrastructure de certificat est valide et que l’heure et la date du proxy d’application Web et du AD FS sont synchronisées. Assurez-vous que l’empreinte numérique configurée pour le proxy d’application Web est correcte.|  
  
Les événements de la console administrateur suivants sont généralement des problèmes de configuration, tels que l’approvisionnement, les demandes qui ne réussissent pas, les serveurs principaux qui sont inaccessibles et les débordements de mémoire tampon.  
  
|Événement ou symptôme|Cause possible|Résolution|  
|--------------------|------------------|--------------|  
|12019<p>Le proxy d’application Web n’a pas pu créer d’écouteur pour l’URL suivante.|Une cause possible de l’événement est qu’un autre service écoute la même URL.|L’administrateur doit s’assurer qu’aucun d’entre eux n’écoute ou ne se lie aux mêmes URL. Pour ce faire, exécutez la commande suivante : netsh http show urlacl. Si cette URL est utilisée par un autre composant s’exécutant sur l’ordinateur proxy d’application Web, supprimez-la ou utilisez une autre URL pour publier les applications via le proxy d’application Web.|  
|12020<p>Le proxy d’application Web n’a pas pu créer de réservation pour l’URL suivante.|Une cause possible de l’événement est qu’un autre service a une réservation sur la même URL.|L’administrateur doit s’assurer qu’aucun lien n’est lié aux mêmes URL. Pour ce faire, exécutez la commande suivante : netsh http show urlacl. Si cette URL est utilisée par un autre composant s’exécutant sur l’ordinateur proxy d’application Web, supprimez-la ou utilisez une autre URL pour publier les applications via le proxy d’application Web.|  
|12021<p>Le proxy d’application Web n’a pas pu lier le certificat de serveur SSL. Tous les autres paramètres de configuration ont été appliqués.|Impossible de créer et de définir un enregistrement de configuration de données de certificat SSL.|Assurez-vous que les empreintes numériques de certificat configurées pour l’application Web Proxyapplications sont installées sur tous les ordinateurs du proxy d’application Web avec une clé privée dans le magasin de l’ordinateur local.|  
|13001<p>Le certificat de serveur SSL présenté au proxy d’application Web par le serveur principal n’est pas valide. le certificat n’est pas approuvé.|Une ou plusieurs erreurs ont été détectées dans le certificat protocole SSL (SSL) envoyé par le serveur. Cela peut indiquer que le serveur principal a fourni un protocole SSL qui n’est pas valide ou qu’il n’existe aucune relation d’approbation entre le proxy d’application Web et le serveur principal.|Validez un certificat SSL de serveur principal. Assurez-vous que l’ordinateur proxy d’application Web est configuré avec les autorités de certification racine appropriées pour approuver le certificat de serveur principal.|  
|13006|Lorsque le code d’erreur est 0x80072EE7, le failurrre est provoqué par l’incapacité à résoudre l’URL du serveur principal. D’autres codes d’erreur sont décrits dans [https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85)](https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85))|Vérifiez que l’URL du serveur principal est correcte et que son nom peut être résolu correctement à partir de l’ordinateur proxy d’application Web.|  
|13007<p>La réponse HTTP du serveur principal n’a pas été reçue dans l’intervalle attendu.|La demande du serveur de back end a expiré ou est lente ou ne répond pas.|Vérifiez la configuration du serveur principal. S’il est très lent, vérifiez la connectivité au serveur principal et envisagez de modifier l’applet de commande du proxy d’application Web global configuration pour InactiveTransactionsTimeoutSec.|  
  
## <a name="see-also"></a>Voir aussi  
[Nouveautés du proxy d’application Web dans Windows Server 2016](web-application-proxy-windows-server.md)  
[Utilisation du proxy d’application Web](assetId:///b607b717-2172-4271-98d1-fa8162e0bb2e)  
  


